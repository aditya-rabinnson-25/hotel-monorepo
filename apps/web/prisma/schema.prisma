generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  active
  suspended
  invited
}

enum UserRole {
  super_admin
  admin
  manager
  staff
  viewer
}

model User {
  id            String     @id @default(cuid())
  name          String
  email         String     @unique
  emailVerified Boolean    @default(false)
  image         String?
  passwordHash  String?
  role          UserRole   @default(viewer)
  status        UserStatus @default(active)

  hotelId String?
  hotel   Hotel?  @relation(fields: [hotelId], references: [id])

  // Add this line ðŸ‘‡
  ownedHotels Hotel[] @relation("HotelOwner")

  // Relations
  sessions      Session[]
  accounts      Account[]
  verifications Verification[]
  memberships   Membership[]
  organizations UserOrganization[]
  teamMembers   TeamMember[]
  devices       Device[]
  notifications Notification[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  hotelId   String?
  expiresAt DateTime
  token     String   @unique
  ipAddress String?
  userAgent String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Account {
  id                    String    @id @default(cuid())
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  provider              String
  providerAccountId     String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  tokenType             String?
  scope                 String?
  expiresAt             Int?
  accountId             String?
  providerId            String?
  password              String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([provider, providerAccountId])
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  userId     String?
  user       User?    @relation(fields: [userId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt
}

model Hotel {
  id        String   @id @default(cuid())
  name      String
  address   String?
  kycStatus String   @default("pending")
  ownerId   String?
  owner     User?    @relation("HotelOwner", fields: [ownerId], references: [id])
  users     User[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Membership {
  id             String @id @default(cuid())
  userId         String
  organizationId String
  role           String

  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Organization {
  id          String             @id @default(cuid())
  name        String
  slug        String?            @unique
  memberships Membership[]
  userOrgs    UserOrganization[]
  teams       Team[]
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
}

model UserOrganization {
  id             String @id @default(cuid())
  userId         String
  organizationId String

  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Team {
  id             String @id @default(cuid())
  name           String
  organizationId String

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  members      TeamMember[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TeamMember {
  id     String @id @default(cuid())
  teamId String
  userId String

  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Device {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  hotelId    String?
  name       String?
  lastSeenAt DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  hotelId   String?
  title     String
  body      String?
  seen      Boolean  @default(false)
  createdAt DateTime @default(now())
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}
